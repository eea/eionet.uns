<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--
     You can run this change log on your database as many times as you want, it will ignore the
     changes that are already applied. It also means that you can't modify an existing revision.
     Always add to the end.

     Use the maven goals: liquibase:update, liquibase:status or liquibase:changelogSync
      Potentially with -Dliquibase.dropFirst=true
     $Id$
 -->
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <property name="afterburner" value=" ENGINE=InnoDB DEFAULT CHARSET=utf8" dbms="mysql"/>

    <changeSet author="heinlja" id="rev-1">
        <createTable tableName="ACL_ROWS">
            <column defaultValueNumeric="0" name="ACL_ID" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'object'" name="TYPE" type="enum('object','doc','dcc')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'user'" name="ENTRY_TYPE" type="enum('owner','user','localgroup','other','foreign','unauthenticated','authenticated','mask')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PRINCIPAL" type="CHAR(16)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PERMISSIONS" type="CHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="STATUS" type="INT"/>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
        <modifySql dbms="h2">
            <replace replace="enum('object','doc','dcc')" with="CHAR(6)"/>
            <replace replace="enum('owner','user','localgroup','other','foreign','unauthenticated','authenticated','mask')" with="CHAR(20)"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-2">
        <addPrimaryKey columnNames="ACL_ID, TYPE, ENTRY_TYPE, PRINCIPAL" tableName="ACL_ROWS"/>
    </changeSet>

    <changeSet author="heinlja" id="rev-3">
        <createTable tableName="ACLS">
            <column autoIncrement="true" name="ACL_ID" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="ACL_NAME" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="PARENT_NAME" type="VARCHAR(100)"/>
            <column defaultValue="" name="OWNER" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="DESCRIPTION" type="VARCHAR(255)"/>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-4">
        <createIndex indexName="ACL_NAME" tableName="ACLS" unique="true">
            <column name="ACL_NAME"/>
            <column name="PARENT_NAME"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-5">
        <createTable tableName="CHANNEL">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="STYLESHEET_ID" type="INT UNSIGNED"/>
            <column name="NOTIFICATION_TEMPLATE_ID" type="INT UNSIGNED"/>
            <column defaultValueNumeric="0" name="CREATOR" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="TITLE" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" type="VARCHAR(255)"/>
            <column name="LAST_HARVEST" type="DATETIME"/>
            <column defaultValue="PULL" name="MODE" type="VARCHAR(4)">
                <constraints nullable="false"/>
            </column>
            <column name="FEED_URL" type="VARCHAR(255)"/>
            <column defaultValueNumeric="600" name="REFRESH_DELAY" type="INT UNSIGNED"/>
            <column defaultValue="0000-00-00 00:00:00" name="CREATION_DATE" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="false" name="CSTATUS" type="BIT">
                <constraints nullable="false"/>
            </column>
            <column name="SECONDARY_ID" type="VARCHAR(255)"/>
            <column defaultValue="" name="LANGUAGE_ID" type="CHAR(2)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-6">
        <createIndex indexName="CHANNEL_FKIndex3" tableName="CHANNEL" unique="false">
            <column name="STYLESHEET_ID"/>
        </createIndex>
        <createIndex indexName="IX_EEAUSER_FK" tableName="CHANNEL" unique="false">
            <column name="CREATOR"/>
        </createIndex>
        <createIndex indexName="IX_NAME_UNIQ1" tableName="CHANNEL" unique="true">
            <column name="TITLE"/>
        </createIndex>
        <createIndex indexName="IX_SECID_UNIQ1" tableName="CHANNEL" unique="true">
            <column name="SECONDARY_ID"/>
        </createIndex>
        <createIndex indexName="IX_TEMPLATE_FK" tableName="CHANNEL" unique="false">
            <column name="NOTIFICATION_TEMPLATE_ID"/>
        </createIndex>
        <createIndex indexName="IX_URL_UINQUE" tableName="CHANNEL" unique="true">
            <column name="FEED_URL"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-7">
        <createTable tableName="CHANNEL_DELIVERY_TYPE">
            <column defaultValueNumeric="0" name="CHANNEL_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DELIVERY_TYPE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-8">
        <addPrimaryKey columnNames="CHANNEL_ID, DELIVERY_TYPE_ID" tableName="CHANNEL_DELIVERY_TYPE"/>
        <createIndex indexName="IX_CHANNEL_FK1" tableName="CHANNEL_DELIVERY_TYPE" unique="false">
            <column name="CHANNEL_ID"/>
        </createIndex>
        <createIndex indexName="IX_DT_FK" tableName="CHANNEL_DELIVERY_TYPE" unique="false">
            <column name="DELIVERY_TYPE_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-9">
        <createTable tableName="CHANNEL_METADATA_ELEMENTS">
            <column defaultValueNumeric="0" name="CHANNEL_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="METADATA_ELEMENT_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="VISIBLE" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="APPEARANCE_ORDER" type="INT"/>
            <column defaultValueBoolean="false" name="FILTERED" type="BIT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="false" name="OBSOLETE" type="BIT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-10">
        <addPrimaryKey columnNames="CHANNEL_ID, METADATA_ELEMENT_ID" tableName="CHANNEL_METADATA_ELEMENTS"/>
        <createIndex indexName="IX_CHANNEL_FK2" tableName="CHANNEL_METADATA_ELEMENTS" unique="false">
            <column name="CHANNEL_ID"/>
        </createIndex>
        <createIndex indexName="IX_METADATA_ELEMENT_FK" tableName="CHANNEL_METADATA_ELEMENTS" unique="false">
            <column name="METADATA_ELEMENT_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-11">
        <createTable tableName="CHANNEL_ROLE">
            <column defaultValueNumeric="0" name="CHANNEL_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="EEA_ROLE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-12">
        <addPrimaryKey columnNames="CHANNEL_ID, EEA_ROLE_ID" tableName="CHANNEL_ROLE"/>
        <createIndex indexName="IX_CHANNEL_FK3" tableName="CHANNEL_ROLE" unique="false">
            <column name="CHANNEL_ID"/>
        </createIndex>
        <createIndex indexName="IX_ROLE_FK" tableName="CHANNEL_ROLE" unique="false">
            <column name="EEA_ROLE_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-13">
        <createTable tableName="DELIVERY">
            <column defaultValueNumeric="0" name="NOTIFICATION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DELIVERY_TYPE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DELIVERY_STATUS" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="0000-00-00 00:00:00" name="DELIVERY_TIME" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-14">
        <addPrimaryKey columnNames="NOTIFICATION_ID, DELIVERY_TYPE_ID" tableName="DELIVERY"/>
        <createIndex indexName="IX_DELIVERY_TYPE_FK1" tableName="DELIVERY" unique="false">
            <column name="DELIVERY_TYPE_ID"/>
        </createIndex>
        <createIndex indexName="IX_DSTATUS" tableName="DELIVERY" unique="false">
            <column name="DELIVERY_STATUS"/>
        </createIndex>
        <createIndex indexName="IX_NOTIFICATION_FK" tableName="DELIVERY" unique="false">
            <column name="NOTIFICATION_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-15">
        <createTable tableName="DELIVERY_ADDRESS">
            <column defaultValueNumeric="0" name="EEA_USER_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DELIVERY_TYPE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="ADDRESS" type="VARCHAR(255)"/>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-16">
        <addPrimaryKey columnNames="EEA_USER_ID, DELIVERY_TYPE_ID" tableName="DELIVERY_ADDRESS"/>
        <createIndex indexName="IX_DELIVERY_TYPE_FK2" tableName="DELIVERY_ADDRESS" unique="false">
            <column name="DELIVERY_TYPE_ID"/>
        </createIndex>
        <createIndex indexName="IX_EEA_USER_FK1" tableName="DELIVERY_ADDRESS" unique="false">
            <column name="EEA_USER_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-17">
        <createTable tableName="DELIVERY_TYPE">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>

    <changeSet author="heinlja" id="rev-18">
        <createTable tableName="EEA_ROLE">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="EXT_ID" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-19">
        <createIndex indexName="Index_2" tableName="EEA_ROLE" unique="false">
            <column name="EXT_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-20">
        <createTable tableName="EEA_USER">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="EXT_USER_ID" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="CN" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="VACATION_EXPIRATION" type="DATETIME"/>
            <column defaultValueBoolean="false" name="VACATION_FLAG" type="BIT">
                <constraints nullable="false"/>
            </column>
            <column name="PAGE_REFRESH_DELAY" type="INT UNSIGNED"/>
            <column name="NUMCOLUMNS" type="SMALLINT UNSIGNED"/>
            <column defaultValueBoolean="false" name="PREFER_HTML" type="BIT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="true" name="PREFER_DASHBOARD" type="BIT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>

    <changeSet author="heinlja" id="rev-21">
        <createTable tableName="EVENT">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValueNumeric="0" name="CHANNEL_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="EXT_ID" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="0000-00-00 00:00:00" name="CREATION_DATE" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="RTYPE" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="PROCESSED" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-22">
        <createIndex indexName="IX_CHANNEL_FK4" tableName="EVENT" unique="false">
            <column name="CHANNEL_ID"/>
        </createIndex>
        <createIndex indexName="IX_CREATION_DATE" tableName="EVENT" unique="false">
            <column name="CREATION_DATE"/>
        </createIndex>
        <createIndex indexName="IX_EXT_ID_UNIQ" tableName="EVENT" unique="true">
            <column name="EXT_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-23">
        <createTable tableName="EVENT_METADATA">
            <column defaultValueNumeric="0" name="EVENT_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PROPERTY" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="VALUE" type="TEXT"/>
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-24">
        <createIndex indexName="EVENT_METADATA_FKIndex1" tableName="EVENT_METADATA" unique="false">
            <column name="EVENT_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-25">
        <createTable tableName="FILTER">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValueNumeric="0" name="SUBSCRIPTION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-26">
        <createIndex indexName="IX_SUBSCRIPTION_FK" tableName="FILTER" unique="false">
            <column name="SUBSCRIPTION_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-27">
        <createTable tableName="METADATA_ELEMENTS">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-28">
        <createIndex indexName="IX_METADATANAME_UNIQ" tableName="METADATA_ELEMENTS" unique="true">
            <column name="NAME"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-29">
        <createTable tableName="NOTIFICATION">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValueNumeric="0" name="EEA_USER_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="EVENT_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="CONTENT" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="CHANNEL_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="SUBJECT" type="VARCHAR(255)"/>
            <column name="HTML_CONTENT" type="TEXT"/>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-30">
        <createIndex indexName="IX_EEA_USER_FK2" tableName="NOTIFICATION" unique="false">
            <column name="EEA_USER_ID"/>
        </createIndex>
        <createIndex indexName="IX_EVENT_FK" tableName="NOTIFICATION" unique="false">
            <column name="EVENT_ID"/>
        </createIndex>
        <createIndex indexName="IX_USEREV_UNIQ" tableName="NOTIFICATION" unique="true">
            <column name="EEA_USER_ID"/>
            <column name="EVENT_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-31">
        <createTable tableName="NOTIFICATION_TEMPLATE">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="SUBJECT" type="VARCHAR(255)"/>
            <column name="TEXT_PLAIN" type="TEXT"/>
            <column name="TEXT_HTML" type="TEXT"/>
            <column defaultValueBoolean="false" name="EDIT_ONLY" type="BIT"/>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-32">
        <createIndex indexName="IX_TNAME_UNIQ" tableName="NOTIFICATION_TEMPLATE" unique="true">
            <column name="NAME"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-33">
        <createTable tableName="STATEMENT">
            <column name="FILTER_ID" type="INT UNSIGNED"/>
            <column defaultValue="" name="PROPERTY" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="VALUE" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="METADATA_ELEMENT_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-34">
        <createIndex indexName="FK_STATEMENT_2" tableName="STATEMENT" unique="false">
            <column name="METADATA_ELEMENT_ID"/>
        </createIndex>
        <createIndex indexName="IX_FILTER_FK" tableName="STATEMENT" unique="false">
            <column name="FILTER_ID"/>
        </createIndex>
        <createIndex indexName="IX_PROPERTY" tableName="STATEMENT" unique="false">
            <column name="PROPERTY"/>
        </createIndex>
        <createIndex indexName="IX_VALUE" tableName="STATEMENT" unique="false">
            <column name="VALUE"/>
        </createIndex>
    </changeSet>


    <changeSet author="heinlja" id="rev-35">
        <createTable tableName="STYLESHEET">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="DESCRIPTION" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="CONTENT" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-36">
        <createIndex indexName="IX_NAME_UNIQ2" tableName="STYLESHEET" unique="true">
            <column name="NAME"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-37">
        <createTable tableName="SUBSCRIPTION">
            <column autoIncrement="true" name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValueNumeric="0" name="EEA_USER_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="CHANNEL_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="LEAD_TIME" type="INT UNSIGNED"/>
            <column defaultValue="0000-00-00 00:00:00" name="CREATION_DATE" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="SECONDARY_ID" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="DASH_CORD_X" type="SMALLINT"/>
            <column name="DASH_CORD_Y" type="SMALLINT"/>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-38">
        <createIndex indexName="IX_CHANNEL_FK5" tableName="SUBSCRIPTION" unique="false">
            <column name="CHANNEL_ID"/>
        </createIndex>
        <createIndex indexName="IX_EEA_USER_FK3" tableName="SUBSCRIPTION" unique="false">
            <column name="EEA_USER_ID"/>
        </createIndex>
        <createIndex indexName="IX_SCREATION_DATE" tableName="SUBSCRIPTION" unique="false">
            <column name="CREATION_DATE"/>
        </createIndex>
        <createIndex indexName="IX_SECID_UNIQ2" tableName="SUBSCRIPTION" unique="true">
            <column name="SECONDARY_ID"/>
        </createIndex>
        <createIndex indexName="IX_USER_CHANNEL_UNIQ" tableName="SUBSCRIPTION" unique="true">
            <column name="EEA_USER_ID"/>
            <column name="CHANNEL_ID"/>
        </createIndex>
    </changeSet>


    <changeSet author="heinlja" id="rev-39">
        <createTable tableName="SUBSCRIPTION_DT">
            <column defaultValueNumeric="0" name="SUBSCRIPTION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DELIVERY_TYPE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value="${afterburner}"/>
        </modifySql>
    </changeSet>
    <changeSet author="heinlja" id="rev-40">
        <addPrimaryKey columnNames="SUBSCRIPTION_ID, DELIVERY_TYPE_ID" tableName="SUBSCRIPTION_DT"/>
        <createIndex indexName="IX_DELIVERY_TYPE_FK3" tableName="SUBSCRIPTION_DT" unique="false">
            <column name="DELIVERY_TYPE_ID"/>
        </createIndex>
        <createIndex indexName="IX_SUBSCRIPTION" tableName="SUBSCRIPTION_DT" unique="false">
            <column name="SUBSCRIPTION_ID"/>
        </createIndex>
    </changeSet>

    <changeSet id="rev-41" author="dmitrant">
        <addColumn tableName="CHANNEL">
            <column name="INSPECTORS" type="TEXT"/>
        </addColumn>
    </changeSet>

    <changeSet author="roug" id="rev-42">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0"><![CDATA[
    SELECT COUNT(*) FROM DELIVERY_TYPE
      ]]></sqlCheck>
        </preConditions>

        <comment>Insert all delivery types</comment>
        <insert tableName="DELIVERY_TYPE">
            <column name="ID" valueNumeric="1"/>
            <column name="NAME" value="EMAIL"/>
        </insert>
        <insert tableName="DELIVERY_TYPE">
            <column name="ID" valueNumeric="2"/>
            <column name="NAME" value="JABBER"/>
        </insert>
        <insert tableName="DELIVERY_TYPE">
            <column name="ID" valueNumeric="3"/>
            <column name="NAME" value="WDB"/>
        </insert>
        <insert tableName="DELIVERY_TYPE">
            <column name="ID" valueNumeric="4"/>
            <column name="NAME" value="RSS"/>
        </insert>
    </changeSet>

    <changeSet author="roug" id="rev-43">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0"><![CDATA[
    SELECT COUNT(*) FROM NOTIFICATION_TEMPLATE
      ]]></sqlCheck>
        </preConditions>

        <comment>Insert basic notification templates</comment>
        <sql><![CDATA[
INSERT INTO NOTIFICATION_TEMPLATE (ID,NAME,SUBJECT,TEXT_PLAIN,TEXT_HTML,EDIT_ONLY) VALUES
 (1,'Default template','\"$EVENT.CHANNEL\" channel: $EVENT.TITLE','$EVENT
You may unsubscribe yourself from the \"$EVENT.CHANNEL\" channel by using the following link: $UNSUSCRIBE_LINK
test 001
Best Regards,
European Environment Agency','<p>$EVENT<br />You may unsubscribe yourself from the \"$EVENT.CHANNEL\" channel by using the following link: $UNSUSCRIBE_LINK</p><p><br /></p><p>Best Regards,<br />European Environment Agency</p><p></p>',1),
 (2,'Unsubcribed - channel access rights changed notification','Unsubscribed from \"$EVENT.CHANNEL\" channel','You have been unsubscribed from the channel \"$EVENT.CHANNEL\" due to access rights changes.

Sorry for the inconvenience,
European Environment Agency','You have been unsubscribed from the channel &quot;$EVENT.CHANNEL&quot; due to access rights changes.<br /> &nbsp;<br /> Sorry for the inconvenience,<br /> European Environment Agency<br />',1),
 (3,'Unsubscribed - channel removed notification','Unsubscribed from \"$EVENT.CHANNEL\" channel','Channel \"$EVENT.CHANNEL\" does not exist anymore.
You will not be receiving notifications for this channel anymore.

Sorry for the inconvenience,
European Environment Agency','Channel \"$EVENT.CHANNEL\" does not exist anymore.<br /> You will not be receiving notifications for this channel anymore.<br />  <br /> Sorry for the inconvenience,<br /> European Environment Agency',1)
]]></sql>
    </changeSet>

    <changeSet author="roug" id="rev-44">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0"><![CDATA[
    SELECT COUNT(*) FROM STYLESHEET
      ]]></sqlCheck>
        </preConditions>

        <comment>Insert basic stylesheets</comment>
        <sql><![CDATA[
INSERT INTO STYLESHEET (ID,NAME,DESCRIPTION,CONTENT) VALUES
 (1,'default.xsl','This stylesheet is able to transform any RSS(0.9x, 1.0 and 2.0) feed to simple HTML','<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"
    xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"
    xmlns:ev=\"http://purl.org/rss/1.0/modules/event/\" xmlns:rss=\"http://purl.org/rss/1.0/\"
    xmlns:dc=\"http://purl.org/dc/elements/1.1/\" exclude-result-prefixes=\"ev rdf rss dc\"
    version=\"1.0\">
    <xsl:output indent=\"yes\" method=\"html\" omit-xml-declaration=\"yes\"/>
    <xsl:param name=\"openinpopup\" select=\"\'true\'\"/>
    <xsl:param name=\"showdescription\" select=\"\'true\'\"/>
    <xsl:param name=\"showtitle\" select=\"\'true\'\"/>
    <xsl:template match=\"/rss\">
        <xsl:apply-templates select=\"channel\"/>
    </xsl:template>
    <xsl:template match=\"/rdf:RDF\">
        <ul>
            <xsl:apply-templates select=\"rss:item\"/>
        </ul>
    </xsl:template>
    <xsl:template match=\"channel\">
        <ul>
            <xsl:apply-templates select=\"item\"/>
        </ul>
    </xsl:template>
    <xsl:template match=\"rss:item\">
        <xsl:variable name=\"description\" select=\"rss:description|dc:description\"/>
        <li>
            <a>
                <xsl:attribute name=\"href\">
                    <xsl:value-of select=\"rss:link|dc:identifier\"/>
                </xsl:attribute>
                <xsl:if test=\"$openinpopup = \'true\'\">
                    <xsl:attribute name=\"target\">_blank</xsl:attribute>
                </xsl:if>
                <xsl:value-of select=\"rss:title|dc:title\"/>
            </a>
            <xsl:if test=\"$showdescription = \'true\' and $description\">
                <p>
                    <xsl:value-of select=\"$description\"/>
                </p>
            </xsl:if>
        </li>
    </xsl:template>
    <xsl:template match=\"item\">
        <xsl:variable name=\"description\" select=\"description\"/>
        <li>
            <a>
                <xsl:attribute name=\"href\">
                    <xsl:value-of select=\"link\"/>
                </xsl:attribute>
                <xsl:if test=\"$openinpopup = \'true\'\">
                    <xsl:attribute name=\"target\">_blank</xsl:attribute>
                </xsl:if>
                <xsl:value-of select=\"title\"/>
            </a>
            <xsl:if test=\"$showdescription = \'true\' and $description\">
                <p>
                    <xsl:value-of select=\"$description\"/>
                </p>
            </xsl:if>
        </li>
    </xsl:template>
</xsl:stylesheet>
'),
 (2,'tograph.xsl','Transforms \"All obligations\" ROD feed to the SVG representing statistic of obligations per year','<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<xsl:stylesheet exclude-result-prefixes=\"ev rdf rss\" version=\"1.0\"
    xmlns:ev=\"http://purl.org/rss/1.0/modules/event/\"
    xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"
    xmlns:rss=\"http://purl.org/rss/1.0/\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">
    <xsl:output indent=\"yes\" method=\"html\" omit-xml-declaration=\"yes\"/>
    <xsl:variable name=\"totalObligations\">
        <xsl:value-of select=\"count(//*[name()=\'item\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2001\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2001\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2002\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2002\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2003\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2003\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2004\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2004\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2005\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2005\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2006\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2006\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2007\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2007\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2008\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2008\'])\"/>
    </xsl:variable>
    <xsl:variable name=\"year2009\">
        <xsl:value-of select=\"count(//*[substring(ev:startdate,1,4)=\'2009\'])\"/>
    </xsl:variable>
    <xsl:template match=\"/\">
        <svg height=\"160\" version=\"1.1\" width=\"550\"
            xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">
            <path d=\"M0 0 L0 420 L800 420 L800 0 Z\" style=\"fill:#F0F0F0;stroke:none;\"/>
            <text fill=\"black\" font-size=\"12\" x=\"180\" y=\"0\">
                <tspan dy=\"10\" x=\"120\">OBLIGATIONS NUMBER PER YEAR 2001-2009</tspan>
            </text>
            <!-- Draw the x and y axes  -->
            <line stroke=\"black\" x1=\"30\" x2=\"500\" y1=\"150\" y2=\"150\"/>
            <line stroke=\"black\" x1=\"30\" x2=\"30\" y1=\"150\" y2=\"0\"/>
            <path d=\"M26 10 L30 0 L34 10 Z\"/>
            <path d=\"M495 145 L500 150 L495 155 Z\"/>
            <!-- y-axis labels -->
            <g style=\"font-size:10\">
                <text x=\"3\" y=\"130\">30</text>
                <text x=\"3\" y=\"110\">60</text>
                <text x=\"3\" y=\"90\">90</text>
                <text x=\"3\" y=\"70\">120</text>
                <text x=\"3\" y=\"50\">150</text>
                <text x=\"3\" y=\"30\">180</text>
            </g>
            <!-- x-axis labels -->
            <g style=\"font-size:10\">
                <text x=\"50\" y=\"160\">2001</text>
                <text x=\"90\" y=\"160\">2002</text>
                <text x=\"130\" y=\"160\">2003</text>
                <text x=\"170\" y=\"160\">2004</text>
                <text x=\"210\" y=\"160\">2005</text>
                <text x=\"250\" y=\"160\">2006</text>
                <text x=\"290\" y=\"160\">2007</text>
                <text x=\"330\" y=\"160\">2008</text>
                <text x=\"370\" y=\"160\">2009</text>
            </g>
            <!-- Draw data -->
            <circle cx=\"50\" cy=\"{150-$year2001*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <circle cx=\"90\" cy=\"{150-$year2002*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <circle cx=\"130\" cy=\"{150-$year2003*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <circle cx=\"170\" cy=\"{150-$year2004*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <circle cx=\"210\" cy=\"{150-$year2005*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <circle cx=\"250\" cy=\"{150-$year2006*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <circle cx=\"290\" cy=\"{150-$year2007*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <circle cx=\"330\" cy=\"{150-$year2008*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <circle cx=\"370\" cy=\"{150-$year2009*0.65}\" fill=\"red\" r=\"4\"
                stroke=\"black\" stroke-width=\"2\"/>
            <line stroke=\"black\" x1=\"50\" x2=\"90\"
                y1=\"{150-$year2001*0.65}\" y2=\"{150-$year2002*0.65}\"/>
            <line stroke=\"black\" x1=\"90\" x2=\"130\"
                y1=\"{150-$year2002*0.65}\" y2=\"{150-$year2003*0.65}\"/>
            <line stroke=\"black\" x1=\"130\" x2=\"170\"
                y1=\"{150-$year2003*0.65}\" y2=\"{150-$year2004*0.65}\"/>
            <line stroke=\"black\" x1=\"170\" x2=\"210\"
                y1=\"{150-$year2004*0.65}\" y2=\"{150-$year2005*0.65}\"/>
            <line stroke=\"black\" x1=\"210\" x2=\"250\"
                y1=\"{150-$year2005*0.65}\" y2=\"{150-$year2006*0.65}\"/>
            <line stroke=\"black\" x1=\"250\" x2=\"290\"
                y1=\"{150-$year2006*0.65}\" y2=\"{150-$year2007*0.65}\"/>
            <line stroke=\"black\" x1=\"290\" x2=\"330\"
                y1=\"{150-$year2007*0.65}\" y2=\"{150-$year2008*0.65}\"/>
            <line stroke=\"black\" x1=\"330\" x2=\"370\"
                y1=\"{150-$year2008*0.65}\" y2=\"{150-$year2009*0.65}\"/>
        </svg>
    </xsl:template>
</xsl:stylesheet>
');
 INSERT INTO STYLESHEET (ID,NAME,DESCRIPTION,CONTENT) VALUES
 (3,'push.xsl','Stylesheet used by push channels','<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"
    xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"
    xmlns:ev=\"http://purl.org/rss/1.0/modules/event/\" xmlns:rss=\"http://purl.org/rss/1.0/\"
    xmlns:dc=\"http://purl.org/dc/elements/1.1/\" exclude-result-prefixes=\"ev rdf rss dc\"
    xmlns:wdb=\"http://wdb.eionet.europa.eu/elements#\"
    version=\"1.0\">
    <xsl:output indent=\"yes\" method=\"html\" omit-xml-declaration=\"yes\"/>
    <xsl:param name=\"openinpopup\" select=\"\'false\'\"/>
    <xsl:param name=\"showdescription\" select=\"\'true\'\"/>
    <xsl:param name=\"showtitle\" select=\"\'true\'\"/>
    <xsl:template match=\"/rss\">
        <xsl:apply-templates select=\"channel\">
            <xsl:sort select=\"wdb:created\" order=\"descending\"/>
        </xsl:apply-templates>
    </xsl:template>
    <xsl:template match=\"/rdf:RDF\">
        <ul>
            <xsl:apply-templates select=\"rss:item\">
               <xsl:sort select=\"wdb:created\" order=\"descending\"/>
            </xsl:apply-templates>
        </ul>
    </xsl:template>
    <xsl:template match=\"channel\">
        <ul>
            <xsl:apply-templates select=\"item\"/>
        </ul>
    </xsl:template>
    <xsl:template match=\"rss:item\">
        <xsl:variable name=\"description\" select=\"rss:description|dc:description\"/>
        <li>
            <a>
                <xsl:attribute name=\"href\">
                    <xsl:value-of select=\"rss:link|dc:identifier\"/>
                </xsl:attribute>
                <xsl:if test=\"$openinpopup = \'true\'\">
                    <xsl:attribute name=\"target\">_blank</xsl:attribute>
                </xsl:if>
                <xsl:value-of select=\"rss:title|dc:title\"/>
            </a>
            <xsl:if test=\"$showdescription = \'true\' and $description\">
                <p>
                    <xsl:value-of select=\"$description\"/>
                </p>
            </xsl:if>
        </li>
    </xsl:template>
    <xsl:template match=\"item\">
        <xsl:variable name=\"description\" select=\"description\"/>
        <li>
            <a>
                <xsl:attribute name=\"href\">
                    <xsl:value-of select=\"link\"/>
                </xsl:attribute>
                <xsl:if test=\"$openinpopup = \'true\'\">
                    <xsl:attribute name=\"target\">_blank</xsl:attribute>
                </xsl:if>
                <xsl:value-of select=\"title\"/>
            </a>
            <xsl:if test=\"$showdescription = \'true\' and $description\">
                <p>
                    <xsl:value-of select=\"$description\"/>
                </p>
            </xsl:if>
        </li>
    </xsl:template>
</xsl:stylesheet>
');
INSERT INTO STYLESHEET (ID,NAME,DESCRIPTION,CONTENT) VALUES
 (4,'peifer_obligations.xsl','Obligation deadlines with Peifer example dashboard images','<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<xsl:stylesheet exclude-result-prefixes=\"ev rdf rss dc\" version=\"1.0\"
    xmlns:dc=\"http://purl.org/dc/elements/1.1/\"
    xmlns:ev=\"http://purl.org/rss/1.0/modules/event/\"
    xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"
    xmlns:rss=\"http://purl.org/rss/1.0/\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">
    <xsl:output indent=\"yes\" method=\"xhtml\" omit-xml-declaration=\"yes\"/>
    <xsl:variable name=\"currentMonth\" select=\"month-from-date(current-date())\"/>
    <xsl:variable name=\"currentYear\" select=\"year-from-date(current-date())\"/>
    <xsl:template match=\"/rdf:RDF\">
        <table style=\"table-layout: fixed;\">
            <xsl:apply-templates>
                <xsl:sort select=\"ev:startdate\"/>
            </xsl:apply-templates>
        </table>
    </xsl:template>
    <xsl:template match=\"rss:item\">
        <xsl:variable name=\"description\" select=\"rss:description|dc:description\"/>
        <xsl:variable name=\"oblYear\" select=\"substring(ev:startdate,1,4)\"/>
        <xsl:variable name=\"oblMonth\" select=\"substring(substring(ev:startdate,6,7),1,2)\"/>
        <xsl:if test=\"$oblYear = $currentYear\">
            <tr>
                <td style=\"width: 25px;\" valign=\"top\">
                    <xsl:element name=\"img\">
                        <xsl:attribute name=\"alt\">clck</xsl:attribute>
                        <xsl:attribute name=\"title\">clock</xsl:attribute>
                        <xsl:choose>
                            <xsl:when test=\"$oblMonth &lt; $currentMonth\">
                                <xsl:attribute name=\"src\">../../images/gallery/peifer/pclock.png</xsl:attribute>
                            </xsl:when>
                            <xsl:when test=\"$currentMonth=$oblMonth\">
                                <xsl:attribute name=\"src\">../../images/gallery/peifer/nclock.png</xsl:attribute>
                            </xsl:when>
                            <xsl:otherwise>
                                <xsl:attribute name=\"src\">../../images/gallery/peifer/fclock.png</xsl:attribute>
                            </xsl:otherwise>
                        </xsl:choose>
                    </xsl:element>
                </td>
                <td nowrap=\"nowrap\" style=\"width: 70px;\" valign=\"top\">
                    <xsl:value-of select=\"ev:startdate\"/>
                </td>
                <td valign=\"top\">
                    <a>
                        <xsl:attribute name=\"href\">
                            <xsl:value-of select=\"rss:link|dc:identifier\"/>
                        </xsl:attribute>
                        <xsl:attribute name=\"target\">_blank</xsl:attribute>
                        <xsl:value-of select=\"rss:title|dc:title\"/>
                    </a>
                </td>
            </tr>
        </xsl:if>
    </xsl:template>
</xsl:stylesheet>
');
INSERT INTO STYLESHEET (ID,NAME,DESCRIPTION,CONTENT) VALUES
 (5,'peifer_roles.xsl','Directory roles with Peifer example dashboard images','<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<xsl:stylesheet exclude-result-prefixes=\"ev rdf rss dc\" version=\"1.0\"
    xmlns:dc=\"http://purl.org/dc/elements/1.1/\"
    xmlns:ev=\"http://purl.org/rss/1.0/modules/event/\"
    xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"
    xmlns:rss=\"http://purl.org/rss/1.0/\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">
    <xsl:output indent=\"yes\" method=\"xhtml\" omit-xml-declaration=\"yes\"/>
    <xsl:param name=\"openinpopup\" select=\"\'false\'\"/>
    <xsl:param name=\"showdescription\" select=\"\'true\'\"/>
    <xsl:param name=\"showtitle\" select=\"\'true\'\"/>
    <xsl:template match=\"/rss\">
        <xsl:apply-templates select=\"channel\"/>
    </xsl:template>
    <xsl:template match=\"channel\">
        <table>
            <xsl:apply-templates select=\"item\"/>
        </table>
    </xsl:template>
    <xsl:template match=\"item\">
        <xsl:variable name=\"description\" select=\"description\"/>
        <tr>
            <td rowspan=\"3\" valign=\"top\">
                <img alt=\"o\" src=\"../../images/gallery/peifer/b_role-userdetails-on.gif\"/>
            </td>
            <td/>
        </tr>
        <tr>
            <td valign=\"top\">
                <a>
                    <xsl:attribute name=\"href\">
                        <xsl:value-of select=\"link\"/>
                    </xsl:attribute>
                    <xsl:attribute name=\"target\">_blank</xsl:attribute>
                    <xsl:value-of select=\"title\"/>
                </a>
            </td>
        </tr>
        <tr>
            <td>
                <xsl:if test=\"$description\">
                    <xsl:value-of select=\"$description\"/>
                </xsl:if>
            </td>
        </tr>
    </xsl:template>
</xsl:stylesheet>
'),
 (6,'peifer_users.xsl','Directory users with Peifer example dashboard images','<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<xsl:stylesheet exclude-result-prefixes=\"ev rdf rss dc\" version=\"1.0\"
    xmlns:dc=\"http://purl.org/dc/elements/1.1/\"
    xmlns:ev=\"http://purl.org/rss/1.0/modules/event/\"
    xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"
    xmlns:rss=\"http://purl.org/rss/1.0/\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">
    <xsl:output indent=\"yes\" method=\"xhtml\" omit-xml-declaration=\"yes\"/>
    <xsl:template match=\"/rss\">
        <xsl:apply-templates select=\"channel\"/>
    </xsl:template>
    <xsl:template match=\"channel\">
        <table>
            <xsl:apply-templates select=\"item\"/>
        </table>
    </xsl:template>
    <xsl:template match=\"item\">
        <xsl:variable name=\"description\" select=\"description\"/>
        <tr>
            <td rowspan=\"3\" valign=\"top\">
                <xsl:choose>
                    <xsl:when test=\"contains(title,\'addition\')\">
                        <img alt=\"o\" src=\"../../images/gallery/peifer/add-member.gif\"/>
                    </xsl:when>
                    <xsl:otherwise>
                        <img alt=\"o\" src=\"../../images/gallery/peifer/del-member.gif\"/>
                    </xsl:otherwise>
                </xsl:choose>
            </td>
            <td/>
        </tr>
        <tr>
            <td valign=\"top\">
                <a>
                    <xsl:attribute name=\"href\">
                        <xsl:value-of select=\"link\"/>
                    </xsl:attribute>
                    <xsl:attribute name=\"target\">_blank</xsl:attribute>
                    <xsl:value-of select=\"title\"/>
                </a>
            </td>
        </tr>
        <tr>
            <td>
                <xsl:if test=\"$description\">
                    <xsl:value-of select=\"$description\"/>
                </xsl:if>
            </td>
        </tr>
    </xsl:template>
</xsl:stylesheet>');
]]></sql>
    </changeSet>

    <changeSet id="rev-45" author="heinlja">
        <addColumn tableName="EVENT">
            <column name="LAST_SEEN" type="DATETIME"/>
        </addColumn>
    </changeSet>

    <changeSet id="rev-46" author="heinlja">
        <comment>Set LAST_SEEN of events that don't have it yet.</comment>
        <sql>
            update EVENT set LAST_SEEN=now() where LAST_SEEN is null;
        </sql>
    </changeSet>

<!--
     The following changeset is a reverse engineering of UNS2-create.sql, and was not applied to
     production for several years. If you activate them, there might be issues with unit tests
     as the database tables get flushed in unpredicable order.
 -->
<!--
    <changeSet author="roug" id="rev-45" context="production">
        <addForeignKeyConstraint
            constraintName="FK_NOTIFICATION_TEMPLATE"
            baseTableName="CHANNEL"
            baseColumnNames="NOTIFICATION_TEMPLATE_ID"
            referencedTableName="NOTIFICATION_TEMPLATE"
            referencedColumnNames="ID"
        />
        <addForeignKeyConstraint
            constraintName="CHANNEL_ibfk_1"
            baseTableName="CHANNEL"
            baseColumnNames="CREATOR"
            referencedTableName="EEA_USER"
            referencedColumnNames="ID"
            onDelete="NO ACTION"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="CHANNEL_DELIVERY_TYPE_ibfk_1"
            baseTableName="CHANNEL_DELIVERY_TYPE"
            baseColumnNames="CHANNEL_ID"
            referencedTableName="CHANNEL"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="CHANNEL_DELIVERY_TYPE_ibfk_2"
            baseTableName="CHANNEL_DELIVERY_TYPE"
            baseColumnNames="DELIVERY_TYPE_ID"
            referencedTableName="DELIVERY_TYPE"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="CHANNEL_METADATA_ELEMENTS_ibfk_1"
            baseTableName="CHANNEL_METADATA_ELEMENTS"
            baseColumnNames="CHANNEL_ID"
            referencedTableName="CHANNEL"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="CHANNEL_METADATA_ELEMENTS_ibfk_2"
            baseTableName="CHANNEL_METADATA_ELEMENTS"
            baseColumnNames="METADATA_ELEMENT_ID"
            referencedTableName="METADATA_ELEMENTS"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="CHANNEL_ROLE_ibfk_1"
            baseTableName="CHANNEL_ROLE"
            baseColumnNames="CHANNEL_ID"
            referencedTableName="CHANNEL"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="CHANNEL_ROLE_ibfk_2"
            baseTableName="CHANNEL_ROLE"
            baseColumnNames="EEA_ROLE_ID"
            referencedTableName="EEA_ROLE"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="DELIVERY_ibfk_1"
            baseTableName="DELIVERY"
            baseColumnNames="NOTIFICATION_ID"
            referencedTableName="NOTIFICATION"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="DELIVERY_ibfk_2"
            baseTableName="DELIVERY"
            baseColumnNames="DELIVERY_TYPE_ID"
            referencedTableName="DELIVERY_TYPE"
            referencedColumnNames="ID"
            onDelete="NO ACTION"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="DELIVERY_ADDRESS_ibfk_1"
            baseTableName="DELIVERY_ADDRESS"
            baseColumnNames="EEA_USER_ID"
            referencedTableName="EEA_USER"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="DELIVERY_ADDRESS_ibfk_2"
            baseTableName="DELIVERY_ADDRESS"
            baseColumnNames="DELIVERY_TYPE_ID"
            referencedTableName="DELIVERY_TYPE"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="EVENT_ibfk_1"
            baseTableName="EVENT"
            baseColumnNames="CHANNEL_ID"
            referencedTableName="CHANNEL"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="EVENT_METADATA_ibfk_1"
            baseTableName="EVENT_METADATA"
            baseColumnNames="EVENT_ID"
            referencedTableName="EVENT"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="FILTER_ibfk_1"
            baseTableName="FILTER"
            baseColumnNames="SUBSCRIPTION_ID"
            referencedTableName="SUBSCRIPTION"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="NOTIFICATION_ibfk_1"
            baseTableName="NOTIFICATION"
            baseColumnNames="EVENT_ID"
            referencedTableName="EVENT"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="NOTIFICATION_ibfk_2"
            baseTableName="NOTIFICATION"
            baseColumnNames="EEA_USER_ID"
            referencedTableName="EEA_USER"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="FK_STATEMENT_2"
            baseTableName="STATEMENT"
            baseColumnNames="METADATA_ELEMENT_ID"
            referencedTableName="METADATA_ELEMENTS"
            referencedColumnNames="ID"
        />
        <addForeignKeyConstraint
            constraintName="STATEMENT_ibfk_1"
            baseTableName="STATEMENT"
            baseColumnNames="FILTER_ID"
            referencedTableName="FILTER"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="SUBSCRIPTION_ibfk_1"
            baseTableName="SUBSCRIPTION"
            baseColumnNames="CHANNEL_ID"
            referencedTableName="CHANNEL"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="SUBSCRIPTION_ibfk_2"
            baseTableName="SUBSCRIPTION"
            baseColumnNames="EEA_USER_ID"
            referencedTableName="EEA_USER"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="SUBSCRIPTION_DT_ibfk_1"
            baseTableName="SUBSCRIPTION_DT"
            baseColumnNames="SUBSCRIPTION_ID"
            referencedTableName="SUBSCRIPTION"
            referencedColumnNames="ID"
            onDelete="CASCADE"
            onUpdate="NO ACTION"
        />
        <addForeignKeyConstraint
            constraintName="SUBSCRIPTION_DT_ibfk_2"
            baseTableName="SUBSCRIPTION_DT"
            baseColumnNames="DELIVERY_TYPE_ID"
            referencedTableName="DELIVERY_TYPE"
            referencedColumnNames="ID"
            onDelete="NO ACTION"
            onUpdate="NO ACTION"
        />
    </changeSet>
-->
    <changeSet id="rev-47" author="sofiageo">
        <addColumn tableName="EEA_USER">
            <column defaultValueBoolean="false" name="DISABLED_FLAG" type="BIT">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
</databaseChangeLog>
